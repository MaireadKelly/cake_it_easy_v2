{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    {% load static %}
    {% block meta %}
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="{% block meta_description %}Hand-made cakes, cupcakes, balloons, candles, and custom designs. Secure checkout with Stripe.{% endblock %}">
    {% endblock %}

    {% block extra_meta %}
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/favicon/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'images/favicon/site.webmanifest' %}">
    {% endblock %}

    {% block corecss %}
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    {% endblock %}
    {% block extra_css %}{% endblock %}

    {% block corejs %}
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <!-- Stripe -->
    <script src="https://js.stripe.com/v3/"></script>
    {% endblock %}
    {% block extra_js %}{% endblock %}

    <title>Cake It Easy{% block extra_title %}{% endblock %}</title>
  </head>

  <body>
    <!-- Header (fixed at top) -->
    <header class="container-fluid fixed-top" role="banner">
      <!-- Top row: MOBILE ONLY -->
      <div id="topnav" class="row bg-white d-flex d-lg-none align-items-center">
        <!-- Mobile logo -->
        <div class="col-12 py-1 text-center">
          <a href="{% url 'home' %}" class="nav-link main-logo-link p-0 d-inline-flex align-items-center justify-content-center">
            <img src="{% static 'images/logo.png' %}"
                 srcset="{% static 'images/logo@2x.png' %} 2x"
                 alt="Cake It Easy"
                 width="200" height="64"
                 class="logo-img"
                 loading="eager">
          </a>
        </div>
        <!-- Mobile utilities (search/account/bag) -->
        <div class="col-12 py-1">
          <ul class="list-inline list-unstyled text-center my-0">
            {% include "includes/mobile-top-header.html" %}
          </ul>
        </div>
      </div>

      <!-- Navbar row: DESKTOP (and mobile collapsed) -->
      <div class="row bg-white">
        <nav class="navbar navbar-expand-lg navbar-light w-100" aria-label="Main navigation">
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-nav"
                  aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          {% include "includes/main-nav.html" %}
        </nav>
      </div>

      <!-- Free Delivery Banner -->
      <div class="delivery-banner text-center bg-brand text-white">
        <h4 class="my-1">Free delivery on orders over â‚¬50!</h4>
      </div>
    </header>

    {% if messages %}
      <div class="message-container"></div>
    {% endif %}

    {% block page_header %}{% endblock %}
    {% block content %}{% endblock %}

    {% include "includes/footer.html" %}

    {# Newsletter modal kept as-is #}
    {% block postloadjs %}
      {{ block.super }}
      {% if request.GET.nl %}
      <script>
        (function () {
          try {
            var el = document.getElementById('newsletterModal');
            var code = "{{ request.GET.code|default:'WELCOME10'|escapejs }}";
            var codeEl = document.getElementById('newsletter-code');
            if (codeEl) codeEl.textContent = code;

            if (window.bootstrap && window.bootstrap.Modal) {
              new bootstrap.Modal(el).show();       // Bootstrap 5
            } else if (window.jQuery && typeof jQuery.fn.modal === 'function') {
              jQuery(el).modal('show');             // Bootstrap 4
            }
          } catch (e) {}
        })();
      </script>
      {% endif %}
    {% endblock %}
  </body>
</html>
