{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <h1>Custom Cake #{{ cake.pk }}</h1>

  <div class="card card-body my-3">
    <dl class="row">
      {% if cake.name %}<dt class="col-sm-3">Name</dt><dd class="col-sm-9">{{ cake.name }}</dd>{% endif %}
      {% if cake.occasion %}<dt class="col-sm-3">Occasion</dt><dd class="col-sm-9">{{ cake.get_occasion_display|default:cake.occasion }}</dd>{% endif %}
      {% if cake.flavor %}<dt class="col-sm-3">Flavour</dt><dd class="col-sm-9">{{ cake.flavor }}</dd>{% endif %}
      {% if cake.filling %}<dt class="col-sm-3">Filling</dt><dd class="col-sm-9">{{ cake.filling }}</dd>{% endif %}
      {% if cake.size %}<dt class="col-sm-3">Size</dt><dd class="col-sm-9">{{ cake.size }}</dd>{% endif %}
      {% if cake.inscription %}<dt class="col-sm-3">Inscription</dt><dd class="col-sm-9">{{ cake.inscription }}</dd>{% endif %}
      {% if cake.needed_date %}<dt class="col-sm-3">Needed for</dt><dd class="col-sm-9">{{ cake.needed_date|date:"Y-m-d" }}</dd>{% endif %}
      {% if cake.description %}<dt class="col-sm-3">Notes</dt><dd class="col-sm-9">{{ cake.description }}</dd>{% endif %}
    </dl>

    {% if cake.image %}
      <div class="text-center my-3">
        <img src="{{ cake.image.url }}" class="img-fluid rounded shadow-sm" alt="{{ cake.name }}">
      </div>
    {% endif %}
  </div>

  {# --- Add Deposit to Bag --- #}
  {% if deposit_product %}
    <form method="post" action="{% url 'add_to_bag' deposit_product.id %}" class="mb-3">
      {% csrf_token %}
      <input type="hidden" name="redirect_url" value="{% url 'custom_cake_detail' cake.pk %}">
      <input type="hidden" name="quantity" value="1">
      {# Optional: keep a reference to this custom cake in session; bag view will ignore unknown keys harmlessly #}
      <input type="hidden" name="custom_cake_id" value="{{ cake.id }}">
      <button class="btn btn-primary">
        Add Deposit to Bag (â‚¬{{ deposit_product.price|floatformat:2 }})
      </button>
    </form>
    <p class="text-muted small">
      This deposit reserves your date and covers design time. Final balance is invoiced after we confirm your design.
    </p>
  {% endif %}

  <div class="mt-3">
    <a href="{% url 'custom_cake_edit' cake.pk %}" class="btn btn-outline-primary btn-sm">Edit</a>
    <a href="{% url 'custom_cake_delete' cake.pk %}" class="btn btn-outline-danger btn-sm">Delete</a>
    <a href="{% url 'custom_cake_list' %}" class="btn btn-secondary btn-sm ms-2">Back</a>
  </div>
</div>
{% endblock %}
